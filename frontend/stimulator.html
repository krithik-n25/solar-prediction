<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåû Solar Panel Orientation Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            height: 100vh;
            gap: 20px;
            padding: 20px;
        }

        .control-panel {
            background: rgba(45, 45, 45, 0.9);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 193, 7, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .viewer-panel {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 193, 7, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #FFC107, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #FFC107;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #FFC107;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        label {
            font-weight: 600;
            color: #e0e0e0;
            font-size: 0.95rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            margin-left: 20px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            background: linear-gradient(to right, #333, #666);
            outline: none;
            border-radius: 5px;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFC107, #FF9800);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFC107, #FF9800);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
        }

        .value-display {
            background: rgba(255, 193, 7, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            color: #FFC107;
            min-width: 60px;
            text-align: center;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .efficiency-meter {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }

        .efficiency-value {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 10px;
        }

        .efficiency-bar {
            height: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .efficiency-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .efficiency-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFC107;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #bbb;
            margin-top: 5px;
        }

        .recommendation {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }

        .recommendation h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
        }

        .time-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .time-slider {
            width: 200px;
            margin: 10px 0;
        }

        .sun-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .preset-btn {
            background: linear-gradient(45deg, #333, #555);
            border: 1px solid #FFC107;
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .preset-btn:hover {
            background: linear-gradient(45deg, #FFC107, #FF9800);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFC107;
            font-size: 1.2rem;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .control-panel {
                height: auto;
            }
            
            .viewer-panel {
                height: 70vh;
            }
        }

        .location-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .location-input input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            font-size: 0.9rem;
        }

        .location-input input::placeholder {
            color: #888;
        }
    </style>
</head>
<body>
    <h1>üåû Solar Panel Orientation Visualizer</h1>
    
    <div class="container">
        <div class="control-panel">
            <h2>üéõ Panel Configuration</h2>
            
            <div class="control-group">
                <div class="control-row">
                    <label>Panel Tilt Angle:</label>
                    <div class="slider-container">
                        <input type="range" id="tiltSlider" min="0" max="90" value="30" step="1">
                        <div class="value-display" id="tiltValue">30¬∞</div>
                    </div>
                </div>
                
                <div class="control-row">
                    <label>Azimuth Angle:</label>
                    <div class="slider-container">
                        <input type="range" id="azimuthSlider" min="0" max="360" value="180" step="1">
                        <div class="value-display" id="azimuthValue">180¬∞</div>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3 style="color: #FFC107; margin-bottom: 15px;">üìç Location</h3>
                <div class="location-input">
                    <input type="number" id="latitude" placeholder="Latitude" value="23.0225" step="0.0001">
                    <input type="number" id="longitude" placeholder="Longitude" value="72.5714" step="0.0001">
                </div>
            </div>

            <div class="preset-buttons">
                <button class="preset-btn" onclick="setOptimalAngle()">üéØ Optimal Angle</button>
                <button class="preset-btn" onclick="setSummerAngle()">‚òÄ Summer Setup</button>
                <button class="preset-btn" onclick="setWinterAngle()">‚ùÑ Winter Setup</button>
                <button class="preset-btn" onclick="setTrackingAngle()">üîÑ Sun Tracking</button>
            </div>

            <div class="efficiency-meter">
                <h3 style="color: #FFC107; text-align: center; margin-bottom: 15px;">‚ö° Efficiency Rating</h3>
                <div class="efficiency-value" id="efficiencyValue">85%</div>
                <div class="efficiency-bar">
                    <div class="efficiency-fill" id="efficiencyFill" style="width: 85%"></div>
                </div>
                <div style="text-align: center; color: #4CAF50; font-weight: bold;" id="efficiencyStatus">Excellent Performance!</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="powerOutput">4.2kW</div>
                    <div class="stat-label">Power Output</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dailyEnergy">25.2kWh</div>
                    <div class="stat-label">Daily Energy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="sunHours">6.8h</div>
                    <div class="stat-label">Peak Sun Hours</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="annualSavings">$18,686</div>
                    <div class="stat-label">Annual Savings</div>
                </div>
            </div>

            <div class="recommendation" id="recommendation">
                <h3>üí° Smart Recommendation</h3>
                <p id="recommendationText">Your current panel orientation is performing excellently! This angle maximizes energy capture throughout the day.</p>
            </div>
        </div>

        <div class="viewer-panel">
            <div class="canvas-container">
                <div class="loading" id="loading">Loading 3D Visualization...</div>
                
                <div class="time-controls">
                    <div style="color: #FFC107; font-weight: bold; margin-bottom: 10px;">üïê Time of Day</div>
                    <input type="range" id="timeSlider" class="time-slider" min="6" max="18" value="12" step="0.5">
                    <div style="text-align: center; color: #fff; margin-top: 5px;" id="timeDisplay">12:00 PM</div>
                </div>

                <div class="sun-info">
                    <div style="color: #FFC107; font-weight: bold; margin-bottom: 10px;">‚òÄ Sun Position</div>
                    <div style="color: #fff;">Elevation: <span id="sunElevation">45¬∞</span></div>
                    <div style="color: #fff;">Azimuth: <span id="sunAzimuth">180¬∞</span></div>
                    <div style="color: #fff;">Irradiance: <span id="solarIrradiance">850 W/m¬≤</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, solarPanel, sun, ground;
        let panelTilt = 30, panelAzimuth = 180;
        let currentTime = 12;
        let latitude = 23.0225, longitude = 72.5714; // Ahmedabad coordinates
        let animationId;

        // Initialize the 3D scene
        function initThreeJS() {
            const container = document.querySelector('.canvas-container');
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f0f0f);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(10, 8, 10);
            camera.lookAt(0, 0, 0);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            // Sun (directional light)
            sun = new THREE.DirectionalLight(0xfff5b7, 2);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            sun.shadow.mapSize.height = 2048;
            sun.shadow.camera.near = 0.5;
            sun.shadow.camera.far = 50;
            sun.shadow.camera.left = -10;
            sun.shadow.camera.right = 10;
            sun.shadow.camera.top = 10;
            sun.shadow.camera.bottom = -10;
            scene.add(sun);
            
            // Ground
            const groundGeometry = new THREE.PlaneGeometry(20, 20);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x2d4a2d });
            ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Solar panel
            createSolarPanel();
            
            // Add sun sphere visualization
            const sunGeometry = new THREE.SphereGeometry(0.5, 16, 16);
            const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00, emissive: 0xffaa00 });
            const sunSphere = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sunSphere);
            sun.add(sunSphere);
            
            // Initialize sun position
            updateSunPosition();
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Start animation loop
            animate();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
        }

        function createSolarPanel() {
            // Panel group
            const panelGroup = new THREE.Group();
            
            // Panel surface (blue with grid pattern)
            const panelGeometry = new THREE.BoxGeometry(4, 0.1, 6);
            const panelMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x1a4480,
                shininess: 100,
                transparent: true,
                opacity: 0.9
            });
            const panel = new THREE.Mesh(panelGeometry, panelMaterial);
            panel.castShadow = true;
            panel.receiveShadow = true;
            panelGroup.add(panel);
            
            // Panel frame
            const frameGeometry = new THREE.BoxGeometry(4.2, 0.2, 6.2);
            const frameMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
            const frame = new THREE.Mesh(frameGeometry, frameMaterial);
            frame.position.y = -0.15;
            panelGroup.add(frame);
            
            // Grid lines on panel
            const gridMaterial = new THREE.LineBasicMaterial({ color: 0x0066cc });
            for (let i = -1.5; i <= 1.5; i += 0.5) {
                const lineGeometry = new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(i, 0.06, -3),
                    new THREE.Vector3(i, 0.06, 3)
                ]);
                const line = new THREE.Line(lineGeometry, gridMaterial);
                panelGroup.add(line);
            }
            for (let j = -2.5; j <= 2.5; j += 0.5) {
                const lineGeometry = new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(-2, 0.06, j),
                    new THREE.Vector3(2, 0.06, j)
                ]);
                const line = new THREE.Line(lineGeometry, gridMaterial);
                panelGroup.add(line);
            }
            
            // Support structure
            const supportGeometry = new THREE.CylinderGeometry(0.1, 0.1, 3);
            const supportMaterial = new THREE.MeshPhongMaterial({ color: 0x666666 });
            
            const support1 = new THREE.Mesh(supportGeometry, supportMaterial);
            support1.position.set(-1.5, -1.5, -2);
            panelGroup.add(support1);
            
            const support2 = new THREE.Mesh(supportGeometry, supportMaterial);
            support2.position.set(1.5, -1.5, -2);
            panelGroup.add(support2);
            
            const support3 = new THREE.Mesh(supportGeometry, supportMaterial);
            support3.position.set(-1.5, -1.5, 2);
            panelGroup.add(support3);
            
            const support4 = new THREE.Mesh(supportGeometry, supportMaterial);
            support4.position.set(1.5, -1.5, 2);
            panelGroup.add(support4);
            
            panelGroup.position.y = 1.5;
            solarPanel = panelGroup;
            scene.add(solarPanel);
        }

        function updatePanelOrientation() {
            if (solarPanel) {
                // Convert angles to radians
                const tiltRad = (panelTilt * Math.PI) / 180;
                const azimuthRad = ((panelAzimuth - 180) * Math.PI) / 180; // Adjust for coordinate system
                
                // Apply rotations
                solarPanel.rotation.x = tiltRad;
                solarPanel.rotation.y = azimuthRad;
            }
        }

        function updateSunPosition() {
            if (sun) {
                const sunPosition = calculateSunPosition(latitude, longitude, currentTime);
                
                // Convert sun angles to 3D position
                const distance = 15;
                const elevationRad = (sunPosition.elevation * Math.PI) / 180;
                const azimuthRad = (sunPosition.azimuth * Math.PI) / 180;
                
                const x = distance * Math.cos(elevationRad) * Math.sin(azimuthRad);
                const y = distance * Math.sin(elevationRad);
                const z = distance * Math.cos(elevationRad) * Math.cos(azimuthRad);
                
                sun.position.set(x, y, z);
                sun.lookAt(0, 0, 0);
                
                // Update UI
                document.getElementById('sunElevation').textContent = sunPosition.elevation.toFixed(1) + '¬∞';
                document.getElementById('sunAzimuth').textContent = sunPosition.azimuth.toFixed(1) + '¬∞';
            }
        }

        function calculateSunPosition(lat, lon, time) {
            // Simplified sun position calculation for demo
            const dayOfYear = 180; // Assume summer solstice for demo
            const solarDeclination = 23.45 * Math.sin((360 * (284 + dayOfYear) / 365) * Math.PI / 180);
            
            const hourAngle = 15 * (time - 12);
            const latRad = lat * Math.PI / 180;
            const declRad = solarDeclination * Math.PI / 180;
            const hourRad = hourAngle * Math.PI / 180;
            
            const elevation = Math.asin(
                Math.sin(declRad) * Math.sin(latRad) + 
                Math.cos(declRad) * Math.cos(latRad) * Math.cos(hourRad)
            ) * 180 / Math.PI;
            
            const azimuth = Math.atan2(
                Math.sin(hourRad),
                Math.cos(hourRad) * Math.sin(latRad) - Math.tan(declRad) * Math.cos(latRad)
            ) * 180 / Math.PI + 180;
            
            return { elevation: Math.max(0, elevation), azimuth: azimuth };
        }

        function calculateEfficiency() {
            const sunPosition = calculateSunPosition(latitude, longitude, currentTime);
            
            // Calculate angle between panel normal and sun direction
            const panelNormal = {
                x: Math.sin(panelTilt * Math.PI / 180) * Math.sin(panelAzimuth * Math.PI / 180),
                y: Math.cos(panelTilt * Math.PI / 180),
                z: Math.sin(panelTilt * Math.PI / 180) * Math.cos(panelAzimuth * Math.PI / 180)
            };
            
            const sunVector = {
                x: Math.cos(sunPosition.elevation * Math.PI / 180) * Math.sin(sunPosition.azimuth * Math.PI / 180),
                y: Math.sin(sunPosition.elevation * Math.PI / 180),
                z: Math.cos(sunPosition.elevation * Math.PI / 180) * Math.cos(sunPosition.azimuth * Math.PI / 180)
            };
            
            // Dot product for angle calculation
            const dotProduct = panelNormal.x * sunVector.x + panelNormal.y * sunVector.y + panelNormal.z * sunVector.z;
            const efficiency = Math.max(0, Math.min(100, dotProduct * 100));
            
            return efficiency;
        }

        function updateUI() {
            const efficiency = calculateEfficiency();
            const sunPosition = calculateSunPosition(latitude, longitude, currentTime);
            
            // Update efficiency display
            document.getElementById('efficiencyValue').textContent = Math.round(efficiency) + '%';
            document.getElementById('efficiencyFill').style.width = efficiency + '%';
            
            // Update efficiency status
            const statusElement = document.getElementById('efficiencyStatus');
            if (efficiency > 80) {
                statusElement.textContent = 'Excellent Performance!';
                statusElement.style.color = '#4CAF50';
            } else if (efficiency > 60) {
                statusElement.textContent = 'Good Performance';
                statusElement.style.color = '#FFC107';
            } else if (efficiency > 40) {
                statusElement.textContent = 'Moderate Performance';
                statusElement.style.color = '#FF9800';
            } else {
                statusElement.textContent = 'Poor Performance';
                statusElement.style.color = '#F44336';
            }
            
            // Update power calculations
            const basepower = 5; // kW
            const powerOutput = (basepower * efficiency / 100).toFixed(1);
            const dailyEnergy = (powerOutput * 6).toFixed(1);
            const sunHours = Math.max(0, (sunPosition.elevation / 90 * 8)).toFixed(1);
            const annualSavings = Math.round(dailyEnergy * 70* 0.12); // $0.12  per kWh
            
            document.getElementById('powerOutput').textContent = powerOutput + 'kW';
            document.getElementById('dailyEnergy').textContent = dailyEnergy + 'kWh';
            document.getElementById('sunHours').textContent = sunHours + 'h';
            document.getElementById('annualSavings').textContent = '$' + annualSavings.toLocaleString();
            
            // Solar irradiance calculation
            const irradiance = Math.round(1000 * Math.sin(sunPosition.elevation * Math.PI / 180));
            document.getElementById('solarIrradiance').textContent = Math.max(0, irradiance) + ' W/m¬≤';
            
            // Update recommendations
            const recommendationElement = document.getElementById('recommendationText');
            if (efficiency > 85) {
                recommendationElement.textContent = 'Perfect! Your panel orientation is optimized for maximum energy generation.';
            } else if (efficiency > 70) {
                recommendationElement.textContent = 'Good setup! Consider minor adjustments to the tilt angle for better winter performance.';
            } else if (efficiency > 50) {
                recommendationElement.textContent = 'Moderate performance. Adjusting the azimuth angle could improve energy capture.';
            } else {
                recommendationElement.textContent = 'Poor orientation. Consider using the optimal angle preset for better performance.';
            }
        }

        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Add subtle rotation to camera for dynamic view
            const time = Date.now() * 0.0005;
            camera.position.x = Math.cos(time) * 15;
            camera.position.z = Math.sin(time) * 15;
            camera.lookAt(0, 0, 0);
            
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.querySelector('.canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Preset functions
        function setOptimalAngle() {
            panelTilt = latitude;
            panelAzimuth = 180;
            updateControls();
            updatePanelOrientation();
            updateUI();
        }

        function setSummerAngle() {
            panelTilt = Math.max(0, latitude - 15);
            panelAzimuth = 180;
            updateControls();
            updatePanelOrientation();
            updateUI();
        }

        function setWinterAngle() {
            panelTilt = Math.min(90, latitude + 15);
            panelAzimuth = 180;
            updateControls();
            updatePanelOrientation();
            updateUI();
        }

        function setTrackingAngle() {
            // Set panel to track the current sun position
            const sunPosition = calculateSunPosition(latitude, longitude, currentTime);
            panelTilt = 90 - sunPosition.elevation;
            panelAzimuth = sunPosition.azimuth;
            updateControls();
            updatePanelOrientation();
            updateUI();
        }

        function updateControls() {
            document.getElementById('tiltSlider').value = panelTilt;
            document.getElementById('tiltValue').textContent = Math.round(panelTilt) + '¬∞';
            document.getElementById('azimuthSlider').value = panelAzimuth;
            document.getElementById('azimuthValue').textContent = Math.round(panelAzimuth) + '¬∞';
        }

        // Event listeners
        document.getElementById('tiltSlider').addEventListener('input', function(e) {
            panelTilt = parseFloat(e.target.value);
            document.getElementById('tiltValue').textContent = Math.round(panelTilt) + '¬∞';
            updatePanelOrientation();
            updateUI();
        });

        document.getElementById('azimuthSlider').addEventListener('input', function(e) {
            panelAzimuth = parseFloat(e.target.value);
            document.getElementById('azimuthValue').textContent = Math.round(panelAzimuth) + '¬∞';
            updatePanelOrientation();
            updateUI();
        });

        document.getElementById('timeSlider').addEventListener('input', function(e) {
            currentTime = parseFloat(e.target.value);
            const hours = Math.floor(currentTime);
            const minutes = Math.round((currentTime - hours) * 60);
            const timeString = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0');
            const period = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
            document.getElementById('timeDisplay').textContent = displayHours + ':' + minutes.toString().padStart(2, '0') + ' ' + period;
            
            updateSunPosition();
            updateUI();
        });

        document.getElementById('latitude').addEventListener('input', function(e) {
            latitude = parseFloat(e.target.value) || 0;
            updateSunPosition();
            updateUI();
        });

        document.getElementById('longitude').addEventListener('input', function(e) {
            longitude = parseFloat(e.target.value) || 0;
            updateSunPosition();
            updateUI();
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initThreeJS();
            updateUI();
            
            // Add some initial animations
            setTimeout(() => {
                setOptimalAngle();
            }, 1000);
        });

        // Add mouse controls for camera
        let mouseX = 0, mouseY = 0;
        let isMouseDown = false;

        document.addEventListener('mousemove', function(event) {
            if (isMouseDown) {
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                // Rotate camera around the scene
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
            }
            
            mouseX = event.clientX;
            mouseY = event.clientY;
        });

        document.addEventListener('mousedown', function() {
            isMouseDown = true;
        });

        document.addEventListener('mouseup', function() {
            isMouseDown = false;
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case '1':
                    setOptimalAngle();
                    break;
                case '2':
                    setSummerAngle();
                    break;
                case '3':
                    setWinterAngle();
                    break;
                case '4':
                    setTrackingAngle();
                    break;
                case 'r':
                case 'R':
                    // Reset view
                    camera.position.set(10, 8, 10);
                    camera.lookAt(0, 0, 0);
                    break;
            }
        });

        // Add performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        
        function updatePerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                console.log('FPS:', fps);
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        // Add to animation loop
        const originalAnimate = animate;
        animate = function() {
            updatePerformance();
            originalAnimate();
        };
    </script>
</body>
</html>